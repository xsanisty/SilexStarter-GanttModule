{% set template = config.get('@silexstarter-dashboard.config.template') %}
{% extends '@silexstarter-dashboard/'~ template ~'/index.twig' %}

{% block stylesheet %}
    {{parent()}}

    {{ stylesheet([
        '@xsanisty-gantt/css/dhtmlxgantt.css',
    ]) }}

    <style>
        html, body{ height:100%; padding:0px; margin:0px;}
        .gantt_task_line.gantt_dependent_task {
            background-color: #65c16f;
            border: 1px solid #3c9445;

        }
        .gantt_task_line.gantt_dependent_task .gantt_task_progress {
            background-color: #46ad51;
        }

        .content-wrapper, .right-side, .main-footer {
            margin-left: 0 !important;
        }
    </style>
{% endblock %}

{% block sidebar %}{% endblock %}
{% block navbar %}{% endblock %}
{% block breadcrumb %}{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-12">
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">{{ chart.name }}</h3>
                    <div class="box-tools pull-right">
                        <button class="btn btn-box-tool" data-toggle="tooltip" title="refresh chart" type="button" id="btn-refresh"><i class="fa fa-refresh"></i></button>
                        <button class="btn btn-box-tool" data-toggle="tooltip" title="export to pdf" type="button" id="btn-export-pdf" onclick="gantt.exportToPDF()"><i class="fa fa-file-pdf-o"></i></button>
                        <button class="btn btn-box-tool" data-toggle="tooltip" title="export to png" type="button" id="btn-export-png" onclick="gantt.exportToPNG()"><i class="fa fa-image"></i></button>
                    </div>
                </div>
                <div class="box-body no-padding">
                    <div id="gantt-container" style="width:100%; height:520px;"></div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    {{parent()}}

    {{ javascript([
        '@xsanisty-gantt/js/dhtmlxgantt.js',
        'http://export.dhtmlx.com/gantt/api.js',
        '@xsanisty-gantt/js/ganttloader.js'
    ]) }}

    <script>

        $('#btn-refresh').click(function(){
            gantt.load(global.ganttApi+'/task/');
        });

        gantt.config.readonly= true;
        gantt.config.columns = [
            {name:"text", label:"Task name", width:200, tree:true },
            {name:"add", label:"", width:44 }
        ];
        gantt.config.xml_date = "%Y-%m-%d %H:%i:%s";


        gantt.init("gantt-container");
        gantt.load(global.ganttApi+'/task/');

        var dp = new gantt.dataProcessor(global.ganttApi);
        dp.init(gantt);
        dp.setTransactionMode("REST");
        dp.defineAction("error", function(sid, response){
            console.log(sid, response);
        });
    </script>

{% endblock %}
